<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>üõí Gi·ªè H√†ng - TTD Restaurant</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: url('/images/Giaodien1.jpeg') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Montserrat', sans-serif;
        }
        .glass-card {
            background: rgba(15, 15, 15, 0.75);
            backdrop-filter: blur(12px);
            border-radius: 1.25rem;
            padding: 2.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
        }
        .font-heading {
            font-family: 'Playfair Display', serif;
        }
        .btn-gold {
            background-color: #facc15;
            color: #111827;
        }
        .btn-gold:hover {
            background-color: #eab308;
        }
        .btn-white {
            background-color: #f3f4f6;
            color: #111827;
        }
        .btn-white:hover {
            background-color: #e5e7eb;
        }
        .table-row:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center px-4 py-10 text-white">
<div class="max-w-6xl w-full glass-card">
    <h1 class="text-4xl font-heading text-yellow-400 text-center mb-10">üõí Gi·ªè H√†ng C·ªßa B·∫°n</h1>

    <!-- ü™ë B√†n ƒë√£ ƒë·∫∑t (n·∫øu c√≥) -->
    <div id="tableInfo" class="text-green-300 font-semibold text-lg mb-6 text-center hidden">
        ü™ë B√†n ƒë√£ ƒë·∫∑t: <span id="tableName"></span>
        <button onclick="cancelTable()" class="ml-2 text-sm text-red-400 hover:text-red-300 underline">(Hu·ª∑)</button>
    </div>

    <!-- N·∫øu gi·ªè h√†ng tr·ªëng -->
    <div th:if="${#lists.isEmpty(cart)}" class="text-center">
        <p class="text-gray-300 italic">B·∫°n ch∆∞a ch·ªçn m√≥n n√†o.</p>
        <a href="/menu" class="mt-4 inline-block px-5 py-2 btn-gold rounded-full font-semibold shadow">‚Üê Quay l·∫°i th·ª±c ƒë∆°n</a>
    </div>

    <!-- N·∫øu c√≥ m√≥n -->
    <div th:if="${not #lists.isEmpty(cart)}">
        <div class="overflow-x-auto rounded-xl shadow">
            <table class="w-full text-sm table-auto">
                <thead class="bg-gray-800 uppercase tracking-widest text-xs">
                    <tr>
                        <th class="p-3 text-left">M√≥n ƒÇn</th>
                        <th class="p-3 text-center">S·ªë L∆∞·ª£ng</th>
                        <th class="p-3 text-right">ƒê∆°n Gi√°</th>
                        <th class="p-3 text-right">Th√†nh Ti·ªÅn</th>
                        <th class="p-3 text-center">Thao T√°c</th>
                    </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${cart}" class="table-row border-b border-gray-700">
                    <td class="p-3 font-medium text-yellow-100" th:text="${item.tenMonAn}">T√™n m√≥n</td>
                    <td class="p-3 text-center">
                        <form th:action="@{/cart/update}" method="post" class="flex justify-center items-center gap-2">
                            <input type="hidden" name="tenMonAn" th:value="${item.tenMonAn}" />
                            <input type="number" name="soLuong" min="1" th:value="${item.soLuong}" class="w-16 p-1 rounded text-center text-black" />
                            <button type="submit" class="text-yellow-400 hover:text-yellow-300 text-xs font-semibold">C·∫≠p nh·∫≠t</button>
                        </form>
                    </td>
                    <td class="p-3 text-right text-yellow-300" th:text="${item.donGia} + '‚Ç´'">0‚Ç´</td>
                    <td class="p-3 text-right font-bold text-green-400" th:text="${item.thanhTien} + '‚Ç´'">0‚Ç´</td>
                    <td class="p-3 text-center">
                        <form th:action="@{/cart/remove}" method="post">
                            <input type="hidden" name="tenMonAn" th:value="${item.tenMonAn}" />
                            <button type="submit" class="text-red-400 hover:text-red-300 text-xs font-semibold">Xo√°</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- T·ªïng ti·ªÅn & h√†nh ƒë·ªông -->
        <div class="mt-8 flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="text-xl font-bold text-yellow-200">
                T·ªïng c·ªông: <span th:text="${total} + '‚Ç´'">0‚Ç´</span>
            </p>
            <div class="flex gap-3">
                <a href="/menu" class="btn-white px-6 py-2 rounded-full font-semibold shadow">‚Üê Ch·ªçn th√™m m√≥n</a>
                <form th:action="@{/taohoadon}" method="post">
                    <input type="hidden" name="tenBan" id="hiddenTableInput" />
                    <button type="submit" class="btn-gold px-6 py-2 rounded-full font-bold shadow">‚úÖ X√°c nh·∫≠n ƒë·∫∑t m√≥n</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Script x·ª≠ l√Ω b√†n ƒë√£ ƒë·∫∑t -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const table = sessionStorage.getItem("selectedTable");
        if (table) {
            document.getElementById("tableName").innerText = table;
            document.getElementById("tableInfo").classList.remove("hidden");

            // ‚úÖ G√°n t√™n b√†n v√†o input form ƒë·ªÉ g·ª≠i v·ªÅ server
            const tableInput = document.getElementById("hiddenTableInput");
            if (tableInput) tableInput.value = table;
        }
    });

    function cancelTable() {
        const table = sessionStorage.getItem("selectedTable");
        if (!table) return;

        fetch('/api/ban/huyban', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ tenBan: table })
        })
        .then(res => {
            if (res.ok) {
                sessionStorage.removeItem("selectedTable");
                document.getElementById("tableInfo").classList.add("hidden");
                const badge = document.getElementById("tableCheckBadge");
                if (badge) badge.classList.add("hidden");
                alert("‚úÖ ƒê√£ hu·ª∑ ƒë·∫∑t b√†n " + table);
            } else {
                alert("‚ùå Kh√¥ng th·ªÉ hu·ª∑ b√†n.");
            }
        })
        .catch(err => {
            console.error("‚ùå L·ªói hu·ª∑ b√†n:", err);
            alert("‚ùå C√≥ l·ªói khi hu·ª∑ b√†n.");
        });
    }
</script>
</body>
</html>
