<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Thá»±c ÄÆ¡n - TTD Restaurant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .card:hover {
      transform: translateY(-4px) scale(1.02);
    }
    .card {
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

<!-- NAVIGATION -->
<nav class="bg-white border-b shadow-sm sticky top-0 z-30">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <div class="text-xl font-bold text-red-600">TTD Restaurant</div>
    <ul class="flex space-x-6 font-semibold text-sm text-gray-700">
      <li><a href="#monchinh" class="hover:text-red-500">MÃ“N CHÃNH</a></li>
      <li><a href="#khaivi" class="hover:text-red-500">KHAI Vá»Š</a></li>
      <li><a href="#trangmieng" class="hover:text-red-500">TRÃNG MIá»†NG</a></li>
      <li><a href="#douong" class="hover:text-red-500">Äá»’ Uá»NG</a></li>
      <li>
        <a href="/cart" class="hover:text-red-500 flex items-center space-x-1 relative">
          <span>ğŸ›’</span>
          <span>Giá» hÃ ng</span>
          <sup id="cartCountBadge" class="absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5 hidden">0</sup>
        </a>
      </li>
      </ul>
  </div>
</nav>

<!-- DANH Má»¤C TEMPLATE (Ãp dá»¥ng cho táº¥t cáº£ danh má»¥c) -->
<section id="monchinh" class="max-w-6xl mx-auto py-10 px-4">
  <h2 class="text-2xl font-bold mb-2 text-red-600">MÃ“N CHÃNH</h2>
  <div class="grid md:grid-cols-2 gap-6 mt-6">
    <div th:each="mon : ${monChinh}"
         class="card bg-white rounded-2xl shadow-lg p-4 flex justify-between items-center cursor-pointer"
         th:attr="data-title=${mon.tenMonAn},
                  data-img='/images/' + ${mon.hinhAnh},
                  data-price=${#numbers.formatDecimal(mon.donGia, 0, 'COMMA', 0, 'POINT')} + 'â‚«'"
         onclick="handleCardClick(this)">
      <div>
        <h3 class="text-lg font-bold text-gray-900" th:text="${mon.tenMonAn}">TÃªn mÃ³n</h3>
        <p class="text-sm text-gray-500 italic">HÆ°Æ¡ng vá»‹ Ä‘á»™c Ä‘Ã¡o, khÃ³ quÃªn</p>
        <p class="text-base font-semibold mt-2 text-red-500"
           th:text="${#numbers.formatDecimal(mon.donGia, 0, 'COMMA', 0, 'POINT')} + 'â‚«'">GiÃ¡</p>
      </div>
      <img th:src="@{/images/{img}(img=${mon.hinhAnh})}" alt="HÃ¬nh mÃ³n Äƒn"
           class="w-28 h-20 rounded-lg object-cover shadow" />
    </div>
  </div>
</section>

<section id="khaivi" class="max-w-6xl mx-auto py-10 px-4">
  <h2 class="text-2xl font-bold mb-2 text-red-600">KHAI Vá»Š</h2>
  <div class="grid md:grid-cols-2 gap-6 mt-6">
    <div th:each="mon : ${khaiVi}"
         class="card bg-white rounded-2xl shadow-lg p-4 flex justify-between items-center cursor-pointer"
         th:attr="data-title=${mon.tenMonAn},
                  data-img='/images/' + ${mon.hinhAnh},
                  data-price=${#numbers.formatDecimal(mon.donGia, 0, 'COMMA', 0, 'POINT')} + 'â‚«'"
         onclick="handleCardClick(this)">
      <div>
        <h3 class="text-lg font-bold text-gray-900" th:text="${mon.tenMonAn}">TÃªn mÃ³n</h3>
        <p class="text-sm text-gray-500 italic">MÃ³n khai vá»‹ tuyá»‡t háº£o</p>
        <p class="text-base font-semibold mt-2 text-red-500"
           th:text="${#numbers.formatDecimal(mon.donGia, 0, 'COMMA', 0, 'POINT')} + 'â‚«'"></p>
      </div>
      <img th:src="@{/images/{img}(img=${mon.hinhAnh})}" alt="HÃ¬nh mÃ³n Äƒn"
           class="w-28 h-20 rounded-lg object-cover shadow" />
    </div>
  </div>
</section>

<section id="trangmieng" class="max-w-6xl mx-auto py-10 px-4">
  <h2 class="text-2xl font-bold mb-2 text-red-600">TRÃNG MIá»†NG</h2>
  <div class="grid md:grid-cols-2 gap-6 mt-6">
    <div th:each="mon : ${trangMieng}"
         class="card bg-white rounded-2xl shadow-lg p-4 flex justify-between items-center cursor-pointer"
         th:attr="data-title=${mon.tenMonAn},
                  data-img='/images/' + ${mon.hinhAnh},
                  data-price=${#numbers.formatDecimal(mon.donGia, 0, 'COMMA', 0, 'POINT')} + 'â‚«'"
         onclick="handleCardClick(this)">
      <div>
        <h3 class="text-lg font-bold text-gray-900" th:text="${mon.tenMonAn}">TÃªn mÃ³n</h3>
        <p class="text-sm text-gray-500 italic">Ngá»t ngÃ o káº¿t thÃºc bá»¯a Äƒn</p>
        <p class="text-base font-semibold mt-2 text-red-500"
           th:text="${#numbers.formatDecimal(mon.donGia, 0, 'COMMA', 0, 'POINT')} + 'â‚«'"></p>
      </div>
      <img th:src="@{/images/{img}(img=${mon.hinhAnh})}" alt="HÃ¬nh mÃ³n Äƒn"
           class="w-28 h-20 rounded-lg object-cover shadow" />
    </div>
  </div>
</section>

<section id="douong" class="max-w-6xl mx-auto py-10 px-4">
  <h2 class="text-2xl font-bold mb-2 text-red-600">Äá»’ Uá»NG</h2>
  <div class="grid md:grid-cols-2 gap-6 mt-6">
    <div th:each="mon : ${doUong}"
         class="card bg-white rounded-2xl shadow-lg p-4 flex justify-between items-center cursor-pointer"
         th:attr="data-title=${mon.tenMonAn},
                  data-img='/images/' + ${mon.hinhAnh},
                  data-price=${#numbers.formatDecimal(mon.donGia, 0, 'COMMA', 0, 'POINT')} + 'â‚«'"
         onclick="handleCardClick(this)">
      <div>
        <h3 class="text-lg font-bold text-gray-900" th:text="${mon.tenMonAn}">TÃªn mÃ³n</h3>
        <p class="text-sm text-gray-500 italic">Giáº£i khÃ¡t sáº£ng khoÃ¡i</p>
        <p class="text-base font-semibold mt-2 text-red-500"
           th:text="${#numbers.formatDecimal(mon.donGia, 0, 'COMMA', 0, 'POINT')} + 'â‚«'"></p>
      </div>
      <img th:src="@{/images/{img}(img=${mon.hinhAnh})}" alt="HÃ¬nh mÃ³n Äƒn"
           class="w-28 h-20 rounded-lg object-cover shadow" />
    </div>
  </div>
</section>

<!-- MODAL DETAIL STYLE -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-xl overflow-hidden max-w-lg w-full animate-fade-in">
    <div class="relative">
      <img id="modalImage" src="" alt="HÃ¬nh mÃ³n Äƒn" class="w-full h-72 object-cover">
      <button onclick="closeModal()" class="absolute top-4 right-4 text-white text-xl font-bold">&times;</button>
    </div>
    <div class="px-6 py-4">
      <h2 id="modalTitle" class="text-xl font-bold text-gray-900 mb-1">TÃªn mÃ³n</h2>
      <p id="modalPrice" class="text-base text-red-500 font-semibold">GiÃ¡</p>
    </div>

    <!-- GIAO DIá»†N Äáº¸P HÆ N: Sá» LÆ¯á»¢NG VÃ€ GIá» HÃ€NG -->
    <div class="px-6 py-4 border-t flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-white">
      <div class="flex items-center space-x-4">
        <button onclick="updateQuantity(-1)" class="w-10 h-10 flex items-center justify-center text-xl font-bold bg-gray-200 text-gray-700 rounded-full hover:bg-gray-300 transition">
          &minus;
        </button>
        <input id="quantityInput" type="number" value="1" min="1"
               class="w-14 text-center text-lg font-medium border border-gray-300 rounded-lg py-1 focus:outline-none focus:ring-2 focus:ring-red-400" />
        <button onclick="updateQuantity(1)" class="w-10 h-10 flex items-center justify-center text-xl font-bold bg-gray-200 text-gray-700 rounded-full hover:bg-gray-300 transition">
          +
        </button>
      </div>
      <button onclick="addToCart()" class="w-full sm:w-auto flex items-center justify-center space-x-2 bg-gradient-to-r from-orange-500 to-red-500 text-white font-semibold px-6 py-3 rounded-full hover:opacity-90 transition">
        <span>ğŸ›’ ThÃªm vÃ o giá»</span>
        <span id="modalTotal" class="font-bold">0â‚«</span>
      </button>
    </div>

    <div class="px-6 py-4 flex justify-end">
      <button onclick="closeModal()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">ÄÃ³ng</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const badge = document.getElementById("cartCountBadge");
  
    // ğŸ‘‰ Khá»Ÿi táº¡o biáº¿n cartCount tá»« sessionStorage (náº¿u cÃ³)
    let cartCount = parseInt(sessionStorage.getItem("cartCount")) || 0;
    if (cartCount > 0 && badge) {
      badge.innerText = cartCount;
      badge.classList.remove("hidden");
    }
  
    // ğŸ‘‰ Xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng click vÃ o mÃ³n Äƒn
    window.handleCardClick = function (element) {
      const title = element.dataset.title;
      const imageUrl = element.dataset.img;
      const price = element.dataset.price;
  
      document.getElementById('modalTitle').innerText = title;
      document.getElementById('modalImage').src = imageUrl;
      document.getElementById('modalPrice').innerText = price;
      document.getElementById('quantityInput').value = 1;
  
      updateTotal();
      document.getElementById('imageModal').classList.remove('hidden');
    }
  
    // ğŸ‘‰ Cáº­p nháº­t sá»‘ lÆ°á»£ng khi nháº¥n + hoáº·c -
    window.updateQuantity = function (delta) {
      const input = document.getElementById("quantityInput");
      let current = parseInt(input.value) || 1;
      current = Math.max(1, current + delta);
      input.value = current;
      updateTotal();
    }
  
    // ğŸ‘‰ TÃ­nh tá»•ng tiá»n trong modal
    function updateTotal() {
      const quantity = parseInt(document.getElementById("quantityInput").value);
      const priceText = document.getElementById("modalPrice").innerText.replace(/[â‚«,]/g, '');
      const price = parseInt(priceText) || 0;
      const total = quantity * price;
      document.getElementById("modalTotal").innerText = total.toLocaleString('vi-VN') + 'â‚«';
    }
  
    // ğŸ‘‰ ThÃªm vÃ o giá» hÃ ng
    window.addToCart = function () {
      const title = document.getElementById('modalTitle').innerText;
      const quantity = parseInt(document.getElementById("quantityInput").value);
      const priceText = document.getElementById("modalPrice").innerText.replace(/[â‚«,]/g, '');
      const price = parseInt(priceText) || 0;
      const total = quantity * price;
  
      fetch('/cart/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          tenMonAn: title,
          soluong: quantity,
          thanhTien: total
        })
      })
      .then(res => {
        if (res.ok) {
          // ğŸ‘‰ Cáº­p nháº­t sá»‘ lÆ°á»£ng giá» hÃ ng
          cartCount += quantity;
          sessionStorage.setItem("cartCount", cartCount);
  
          if (badge) {
            badge.innerText = cartCount;
            badge.classList.remove("hidden");
          }
  
          alert(`âœ… ÄÃ£ thÃªm ${quantity} x ${title} (${total.toLocaleString('vi-VN')}â‚«) vÃ o giá» hÃ ng!`);
          closeModal();
        } else {
          alert("âŒ KhÃ´ng thá»ƒ thÃªm vÃ o giá» hÃ ng. Vui lÃ²ng thá»­ láº¡i.");
        }
      })
      .catch(err => {
        console.error('Lá»—i khi thÃªm vÃ o giá» hÃ ng:', err);
      });
    }
  
    // ğŸ‘‰ ÄÃ³ng modal
    window.closeModal = function () {
      document.getElementById('imageModal').classList.add('hidden');
    }
  });
  </script>
  