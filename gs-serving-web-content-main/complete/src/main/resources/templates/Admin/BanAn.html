<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω B√†n ƒÇn</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        h2 {
            text-align: center;
            margin-top: 20px;
        }

        table {
            width: 80%;
            margin: auto;
            border-collapse: collapse;
            margin-top: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            border: 1px solid #ccc;
            text-align: center;
        }

        th {
            background-color: #f0f0f0;
        }

        button {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        input {
            padding: 5px;
            margin: 5px;
        }

        .center {
            text-align: center;
            margin-top: 20px;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button:hover:not(:disabled) {
            background-color: #dcdcdc;
        }
    </style>
</head>
<body>
<h2>Qu·∫£n l√Ω B√†n ƒÇn</h2>

<div class="center">
    <input type="text" id="searchInput" placeholder="üîç T√¨m t√™n b√†n..." oninput="timBan()">
</div>

<div class="center">
    <input type="text" id="tenBanMoi" placeholder="T√™n b√†n m·ªõi">
    <input type="text" id="trangThaiMoi" placeholder="Tr·∫°ng th√°i (Tr·ªëng/ƒê√£ ƒë·∫∑t)">
    <button onclick="themBan()">‚ûï Th√™m b√†n</button>
</div>

<table>
    <thead>
        <tr>
            <th>M√£ B√†n</th>
            <th>T√™n B√†n</th>
            <th>Tr·∫°ng Th√°i</th>
            <th>H√†nh ƒë·ªông</th>
        </tr>
    </thead>
    <tbody id="banan-table-body">
        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c load t·ª´ API -->
    </tbody>
</table>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadBanAn();
    });

    function loadBanAn() {
        fetch("/ban/api")
            .then(res => res.json())
            .then(data => {
                const tableBody = document.getElementById("banan-table-body");
                tableBody.innerHTML = "";

                data.forEach(ban => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${ban.maBan}</td>
                        <td>${ban.tenBan}</td>
                        <td>${ban.trangThai}</td>
                        <td>
                            <button onclick="suaBan(${ban.maBan}, '${ban.tenBan}', '${ban.trangThai}')">‚úèÔ∏è S·ª≠a</button>
                            <button onclick="xoaBan(${ban.maBan})">üóëÔ∏è Xo√°</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => alert("L·ªói t·∫£i danh s√°ch: " + error.message));
    }

    function themBan() {
        const tenBan = document.getElementById("tenBanMoi").value;
        const trangThai = document.getElementById("trangThaiMoi").value;

        if (!tenBan || !trangThai) {
            alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
            return;
        }

        fetch("/ban/api/them", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ tenBan, trangThai })
        })
        .then(res => res.text())
        .then(msg => {
            alert(msg);
            document.getElementById("tenBanMoi").value = "";
            document.getElementById("trangThaiMoi").value = "";
            loadBanAn();
        });
    }

    function suaBan(maBan, oldTenBan, oldTrangThai) {
        const tenBan = prompt("S·ª≠a t√™n b√†n:", oldTenBan);
        const trangThai = prompt("S·ª≠a tr·∫°ng th√°i:", oldTrangThai);

        if (tenBan && trangThai) {
            fetch("/ban/api/sua", {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ maBan, tenBan, trangThai })
            })
            .then(res => res.text())
            .then(msg => {
                alert(msg);
                loadBanAn();
            });
        }
    }

    function xoaBan(maBan) {
        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° b√†n n√†y?")) {
            fetch(`/ban/api/xoa/${maBan}`, { method: "DELETE" })
                .then(res => res.text())
                .then(msg => {
                    alert(msg);
                    loadBanAn();
                });
        }
    }

    function timBan() {
        const keyword = document.getElementById("searchInput").value.toLowerCase();
        const rows = document.querySelectorAll("#banan-table-body tr");
        rows.forEach(row => {
            const tenBan = row.children[1].innerText.toLowerCase();
            row.style.display = tenBan.includes(keyword) ? "" : "none";
        });
    }
</script>
</body>
</html>
